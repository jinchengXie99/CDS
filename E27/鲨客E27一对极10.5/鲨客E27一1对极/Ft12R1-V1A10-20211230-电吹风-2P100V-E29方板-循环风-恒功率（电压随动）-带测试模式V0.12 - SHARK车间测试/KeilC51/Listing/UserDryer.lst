C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE USERDRYER
OBJECT MODULE PLACED IN .\Output\UserDryer.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\User\Source\UserFiles\UserDryer.c LARGE OMF2 WARNINGLEVEL(0) OPTIMIZE
                    -(5,SPEED) BROWSE INCDIR(..\Library\FU68xx_Hardware_Driver\Include;..\User\Include) DEBUG PRINT(.\Listing\UserDryer.lst) 
                    -TABS(2) OBJECT(.\Output\UserDryer.obj)

line level    source

   1          
   2          
   3          /* Includes -------------------------------------------------------------------------------------*/
   4          #include <FU68xx_2.h>
   5          #include <Myproject.h>
   6          #include <Customer_Debug.h>
   7          
   8          #include <UserGlobal.h>
   9          #include <UserDefine.h>
  10          
  11          /* Private typedef ------------------------------------------------------------------------------*/
  12          /* Private define -------------------------------------------------------------------------------*/
  13          /* Private macro --------------------------------------------------------------------------------*/
  14          /* Private variables ----------------------------------------------------------------------------*/
  15          /* Private function prototypes ------------------------------------------------------------------*/
  16          /* Private functions ----------------------------------------------------------------------------*/
  17          
  18          //============================================================================//
  19          
  20          // ·½°å
  21          #define KEY_ON                GP06          // ¿ªÆô¶Ë
  22          #define KEY_LOCK              GP05          // Ëø¶¨¶Ë
  23          
  24          #define KEY_SPEED             GP17          // ËÙ¶È°´¼ü
  25          #define KEY_HEAT              GP15          // ÈÈ¶È°´¼ü
  26          #define KEY_COOL              GP13          // Àä·ç°´¼ü
  27          
  28          #define LED_SPEED_1           GP03          // ·çËÙµÆ
  29          #define LED_SPEED_2           GP02
  30          #define LED_SPEED_3           GP01
  31          
  32          #define LED_HEAT_1            GP00          // ÈÈÁ¿µÆ
  33          #define LED_HEAT_2            GP37
  34          #define LED_HEAT_3            GP36
  35          
  36          // xjc µµÎ»¶þ½øÖÆ
  37          #define   LED_SPEED_bit_1   GP03
  38          #define   LED_SPEED_bit_2   GP02
  39          #define   LED_SPEED_bit_3   GP01
  40          #define   LED_SPEED_bit_4   GP00
  41          #define   LED_SPEED_bit_5   GP37
  42          #define   LED_SPEED_bit_6   GP36
  43          
  44          // Ô²°å
  45          //#define KEY_ON                GP06          // ¿ªÆô¶Ë
  46          //#define KEY_LOCK              GP05          // Ëø¶¨¶Ë
  47          
  48          //#define KEY_SPEED             GP15          // ËÙ¶È°´¼ü
  49          //#define KEY_HEAT              GP13          // ÈÈ¶È°´¼ü
  50          //#define KEY_COOL              GP17          // Àä·ç°´¼ü
  51          
  52          //#define LED_SPEED_1           GP00          // ·çËÙµÆ
  53          //#define LED_SPEED_2           GP37
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 2   

  54          //#define LED_SPEED_3           GP36
  55          
  56          //#define LED_HEAT_1            GP03          // ÈÈÁ¿µÆ
  57          //#define LED_HEAT_2            GP02
  58          //#define LED_HEAT_3            GP01
  59          
  60          
  61          #define HEAT_WIRE_H_ON        0//(GP11=0)          // ¸ßÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  62          #define HEAT_WIRE_L_ON        0//(GP10=0)          // µÍÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  63          #define HEAT_WIRE_H_OFF       1//(GP11=1)          // ¸ßÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  64          #define HEAT_WIRE_L_OFF       1//(GP10=1)          // µÍÈÈ¼ÓÈÈË¿Ê¹ÄÜ
  65          
  66          #define LED_SET_ON            0             // LEDÓÐÐ§ÁÁ
  67          #define LED_SET_OFF           1             // LEDÎÞÐ§Ãð
  68          
  69          #define SPD_CMD_LV_MAX        63             // ×ªËÙ×î¸ßµ²
  70          #define HEAT_CMD_LV_MAX       4             // ÎÂ¶È×î¸ßµ²
  71          
  72          #define START_SPD_CMD_LV      1             // Æô¶¯×ªËÙµ²ÉèÖÃ  1 2 3
  73          #define START_HEAT_CMD_LV     1             // Æô¶¯ÎÂ¶Èµ²ÉèÖÃ  0 1 2 3 4
  74          #define START_COOL_CMD_LV     0             // Æô¶¯Àä·çµ²ÉèÖÃ
  75          
  76          #define POWER_LV1             70            // 1µ²¹¦ÂÊ - W
  77          #define POWER_LV2             80            // 2µ²¹¦ÂÊ - W
  78          #define POWER_LV3             90            // 3µ²¹¦ÂÊ - W
  79          
  80          #define RPM_LV1               59500         // 1µ²×ªËÙ - RPM
  81          #define RPM_LV2               86000         // 2µ²×ªËÙ - RPM
  82          #define RPM_LV3               120500        // 3µ²×ªËÙ - RPM
  83          
  84          #define HEAT_DUTY_LV1         9              // 1µ²Õ¼¿Õ±È×î´óÖµ - n/5
  85          #define HEAT_DUTY_LV2         13             // 2µ²Õ¼¿Õ±È×î´óÖµ - n/5
  86          #define HEAT_DUTY_LV3         18             // 3µ²Õ¼¿Õ±È×î´óÖµ - n/5
  87          #define HEAT_DUTY_LV4         18             // 3µ²Õ¼¿Õ±È×î´óÖµ - n/5
  88          #define HEAT_DUTY_LV4_1       13             // 3µ²ÎÂ¶È1µµ·çËÙÕ¼¿Õ±È×î´óÖµ - n/5
  89          
  90          #define HEAT_TEMPER_LV1       100             // 1µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  91          #define HEAT_TEMPER_LV2       100             // 2µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  92          #define HEAT_TEMPER_LV3       100            // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  93          #define HEAT_TEMPER_LV4       100             // 4µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  94          
  95          #define HEAT_R_VAL_LV1        29.8255       // 1µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
  96          #define HEAT_R_VAL_LV2        24.816        // 2µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
  97          #define HEAT_R_VAL_LV3        17.4087       // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
  98          #define HEAT_R_VAL_LV4        17.4087       // 4µ²¸ø¶¨ÈÈ·çÎÂ¶È - ÉãÊÏ¶È
  99          
 100          #define THRYRST_ENABLE        1             //  0:½ûÖ¹ 1:Ê¹ÄÜ  ÊÇ·ñ¿ØÖÆ¾§Õ¢¹Ü
 101          #define CHECK_HEATER_TEMPER   1             //  0:½ûÖ¹ 1:Ê¹ÄÜ  ÊÇ·ñ¼ì²âµçÈÈË¿ÎÂ¶ÈÊÇ·ñ
 102          
 103          #define SPEED_LV1             _Q15(RPM_LV1 / MOTOR_SPEED_BASE)
 104          #define SPEED_LV2             _Q15(RPM_LV2 / MOTOR_SPEED_BASE)
 105          #define SPEED_LV3             _Q15(RPM_LV3 / MOTOR_SPEED_BASE)
 106          
 107          #define SPEED_LV_ADD          _Q15(1000 / MOTOR_SPEED_BASE)       // xjc¼ÓÒ»¸öµ²Î» ËÙ¶È¼Ó1000
 108          
 109          #define HEAT_ADC_VAL_LV1      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV1)    // 1µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 110          #define HEAT_ADC_VAL_LV2      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV2)    // 2µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 111          #define HEAT_ADC_VAL_LV3      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV3)    // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 112          #define HEAT_ADC_VAL_LV4      HEAT_CELSIUS_ADC(HEAT_R_VAL_LV4)    // 3µ²¸ø¶¨ÈÈ·çÎÂ¶È¶ÔÓ¦²ÉÑùµç×èÖµ
 113          
 114          #define POWER_DUTY_LV1        CAL_POWER_Q12(POWER_LV1)
 115          #define POWER_DUTY_LV2        CAL_POWER_Q12(POWER_LV2)
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 3   

 116          #define POWER_DUTY_LV3        CAL_POWER_Q12(POWER_LV3)
 117          
 118          #define POWER_UXI_SMP_LV1     (u32)POWER_TO_SMP(POWER_LV1)//*0.9
 119          #define POWER_UXI_SMP_LV2     (u32)POWER_TO_SMP(POWER_LV2)//*0.93
 120          #define POWER_UXI_SMP_LV3     (u32)POWER_TO_SMP(POWER_LV3)//*0.95
 121          
 122          //============================================================================//
 123          
 124          extern u16 PwrOnX1ms;
 125          extern u8  Loop1msCnt;
 126          extern u8  QuickStartFlag;
 127          extern u16 UBusX10;
 128          extern u16 RunningX1ms;
 129          extern u16 IBusFilt_mA;
 130          extern u16 IBusCommand_mA;
 131          extern u16 IBusSmp;
 132          extern u8  KeyOnOffCmd;
 133          extern u8  KeyOnOffTrig;
 134          extern u16 KeyGoDuty;
 135          extern u16 KeyGoDutyMax;
 136          extern u32 idata UxISmp;
 137          extern u32 idata VspPwrCmd;
 138          extern s16 idata VspSpdAlt;
 139          extern s16 idata VspSpdCmd;
 140          extern s16 idata VspSpdCmdMax;
 141          extern u8  idata AlarmFlag;                // ±¨¾¯Öµ
 142          extern u8  idata AlarmFlag2;
 143          
 144          struct KeyType{
 145            u8  Old       :1;     // ²ÉÑù¾ÉÖµ
 146            u8  New       :1;     // ²ÉÑùÐÂÖµ
 147            u8  Filt      :1;     // ²ÉÑùÂË²¨Öµ
 148            u8  Lv        :1;     // ¶Ë¿ÚµçÆ½
 149            u8  PreLv     :1;     // ¶Ë¿ÚµçÆ½¾ÉÖµ
 150            u8  Rise      :1;     // ÉÏÉýÑØ
 151            u8  Fall      :1;     // ÏÂ½µÑØ
 152          };
 153          
 154          struct KeyType KeySpeed;              // 
 155          struct KeyType KeyHeat;               // 
 156          struct KeyType KeyCool;               // 
 157          struct KeyType KeyOnOff;
 158          
 159          u8  KeyPro1msTmr;                     // 
 160          
 161          u8  PwrOnStage;                       // 
 162          u8  HeatDisableFlag;                  // 
 163          
 164          u16 idata HeatTemperADCVal;
 165          s16 idata HeatTemperCelsius;
 166          
 167          u8  idata KeyOnLockLv;                // ÈýÌ¬Ö¸Áî: 0£º¹Ø±Õ£»1£ºÊÜ¿Ø£»2£ºËø¶¨
 168          u8  idata KeyOnLockLvPre;             // ÈýÌ¬Ö¸ÁîÉÏÒ»´ÎÖµ
 169          u8  idata KeyOnLockSmpNew;            // ¶Ë¿Ú²ÉÑù
 170          u8  idata KeyOnLockSmpOld;
 171          u8  idata KeyOnLockKeepCnt;
 172          
 173          u8  idata SpeedShiftStep;           // ËÙ¶Èµ²Êµ¼ÊÖµ 1-4 ÆäÖÐ
 174          u8  idata SpeedCmdLv;               // ËÙ¶Èµ²ÃüÁîÖµ
 175          
 176          u8  idata HeatShiftStep;            // 
 177          u8  idata HeatCmdLv;                // 
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 4   

 178          
 179          u8  idata CoolCmdLv;                // Àä·çÃüÁî
 180          u8  idata CoolShiftLv;              // 
 181          
 182          u8  idata ACCrossForThryrist;       // ¾§Õ¢¹Ü¿ØÖÆ²Î¿¼µÄ½»Á÷¹ýÁã±êÖ¾
 183          
 184          u8  idata RePowerRunTrig;           // ÖØÐÂÉÏµçºóµÄÆô¶¯´¥·¢
 185          
 186          u8  idata HeatDutyH;                // ÉÏ·¢ÈÈË¿¼ÓÈÈÁ¿¸ø¶¨
 187          u8  idata HeatDutyL;                // ÏÂ·¢ÈÈË¿¼ÓÈÈÁ¿¸ø¶¨
 188          u8  idata HeatDutyMax;              // ¼ÓÈÈÁ¿¸÷µ²Î»¶ÔÓ¦µÄÏÞÖÆÖµ
 189          u8  idata HeatDutyAlt;              // ¼ÓÈÈÁ¿µ÷½ÚÖµ
 190          u8  idata HeatDutyAltTop;           // ¼ÓÈÈÁ¿µ÷½ÚÖµÉÏÏÞ
 191          
 192          u8  idata HeatDutyPeriod;           // ¼ÓÈÈ´¦ÀíÖÜÆÚ
 193          u8  idata HeatDutyOnCnt;            // ¼ÓÈÈÓÐÐ§Ê±¶Î
 194          u8  idata HeatDutyOnCnt2;           // ¼ÓÈÈÓÐÐ§Ê±¶Î
 195          
 196          u8  idata ThryristTrigKeepCnt;      // ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
 197          u8  idata ThryristTrigKeepCnt2;     // ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
 198          
 199          s8  idata WindTemperRef;            // ÈÈ·ç¸ø¶¨Öµ ÉãÊÏ¶È
 200          s16 idata HeatAdcValRef;            // ÈÈ·ç¸ø¶¨Öµ ADC×ª»»Öµ
 201          u16 idata LedAltX10ms;
 202          
 203          bit WindTemperHigh;                 // µçÈÈË¿¹ýÈÈ±êÖ¾
 204          bit LedHeat1;
 205          bit LedHeat2;
 206          bit LedHeat3;
 207          bit LedSpd1;
 208          bit LedSpd2;
 209          bit LedSpd3;
 210          
 211          u8  idata KeySpeedActX10ms;         // ÓÐÐ§×´Ì¬±£³Ö¼ÆÊ± ¡Á 10ms
 212          u16 idata ReverseCleanX10ms;        // ·´×ªÇå½àÊ±³¤
 213          
 214          bit ReverseCleanTrig;
 215          bit ReverseCleanCmd;
 216          bit Heat_wire_H = 1;
 217          bit Heat_wire_L = 1;
 218          
 219          u8  HeatRegulTmr;
 220          u8  WindTemperDelta;                // ÈÈ·ç¸ø¶¨ÓëÊµ²â²îÖµ
 221          u16 idata HeatLv4X10ms;             // ÈÈ·ç4µ²¼ÆÊ±
 222          
 223          u8  LedAlarmFlashCnt;               //´íÎóÖ¸Ê¾µÆÉÁË¸¼ÆÊý
 224          
 225          extern u8  HearterPMWDutyRise;
 226          extern u8  HearterPMWDutyDowm;
 227          
 228          u8  PowerVoltDownBase;
 229          u8  PowerVoltRiseBase;                   //Òò²»Í¬µµÎ»Õ¼¿Õ±È²»Í¬£¬ÏàÍ¬µçÑ¹²î¶ÔÓ¦µÄ¹¦ÂÊ²î²»Í¬
 230          
 231          //u8  idata HeatLowDuty=0;          // ¼ÓÈÈÁ¿¸ø¶¨
 232          //u8  idata HeatLowDutyMax=0;       // ¼ÓÈÈÁ¿×î´óÖµ
 233          //u8  idata KeySpeedLvStayCnt=0;    // µ±Ç°µçÆ½±£³Ö¼ÆÊý
 234          
 235          //u8  idata KeyHeatLvStayCnt=0;
 236          //u8  idata KeyHeatActX10ms=0;
 237          //u8  idata KeyCoolLvStayCnt=0;
 238          //u8  idata KeyCoolLvX10ms=0;
 239          //u8  idata KeyMt2LvStayCnt;
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 5   

 240          //u8  idata KeyMt2LvX10ms;
 241          //u8  idata VZeroCrossLose;
 242          //u8  idata VZeroCrossReturn;
 243          //============================================================================//
 244          //----------------------------------------------------------------------------//
 245          // ËµÃ÷£ºËÙ¶Èµ²Î»°´¼ü¼ÆÊýÎª1-2-3-4-1-2...Ñ­»·£¬¶ÔÓ¦µ²Î»±ä»¯Ë³ÐòÎª1-2-3-2-1-2...Ñ­»·¼ÆÊý
 246          void CalSpeedStepToCmd(void)
 247          {
 248   1        // 1  2  3  4  1
 249   1        // 1  2  3  2  1
 250   1        
 251   1        if((SpeedShiftStep == 0)||(SpeedShiftStep >= (2*SPD_CMD_LV_MAX-1)))     // A-0  B-1  C-2  D-3  E-2  F-1 
             - G-2
 252   1          SpeedShiftStep = 1;
 253   1          
 254   1        if(SpeedShiftStep <= SPD_CMD_LV_MAX)
 255   1          SpeedCmdLv = SpeedShiftStep;
 256   1        else
 257   1          SpeedCmdLv = (2*SPD_CMD_LV_MAX) - SpeedShiftStep;
 258   1      }
 259          //----------------------------------------------------------------------------//
 260          // ËµÃ÷£ºÎÂ¶Èµ²Î»°´¼ü¼ÆÊýÎª0-1-2-3-4-5-0-1-2...Ñ­»·£¬¶ÔÓ¦µ²Î»±ä»¯Ë³ÐòÎª0-1-2-3-2-1-0-1-2...Ñ­»·¼ÆÊý
 261          void CalHeatStepToCmd(void)
 262          {
 263   1        // 0  1  2  3  4  5  6  7  0
 264   1        // 0  1  2  3  4  3  2  1  0
 265   1        
 266   1        // ÈÈ·çÓÐ0µ²ÐèÇó
 267   1        if(HeatShiftStep >= (2*HEAT_CMD_LV_MAX))      // A-0  B-1  C-2  D-3  E-4  F-3  G-2  H-1  I-0 
 268   1          HeatShiftStep = 0;
 269   1        
 270   1        // ÈÈ·çÎÞ0µ²ÐèÇó
 271   1      //  if((HeatShiftStep == 0)||(HeatShiftStep >= (2*HEAT_CMD_LV_MAX-1)))      // A-0  B-1  C-2  D-3  E-2  F-
             -1  G-2
 272   1      //    HeatShiftStep = 1;
 273   1        
 274   1        if(HeatShiftStep <= HEAT_CMD_LV_MAX)
 275   1          HeatCmdLv = HeatShiftStep;
 276   1        else
 277   1          HeatCmdLv = (2*HEAT_CMD_LV_MAX) - HeatShiftStep;
 278   1      }
 279          //----------------------------------------------------------------------------//
 280          // ËµÃ÷£º
 281          void CalCoolLvToCmd(void)
 282          {
 283   1        CoolCmdLv = CoolShiftLv;
 284   1      }
 285          //----------------------------------------------------------------------------//
 286          // ËµÃ÷£º¿ª¹Ø³õÊ¼»¯£¬×ªËÙµ²£¬ÎÂ¶Èµ²£¬Àä·çµ²£¬³õÊ¼Öµ¸ø¶¨
 287          void DryerKeysDefault(void)
 288          {
 289   1        SpeedShiftStep = START_SPD_CMD_LV;            // ×ªËÙ
 290   1        HeatShiftStep = START_HEAT_CMD_LV;            // ÎÂ¶È
 291   1        CoolShiftLv = START_COOL_CMD_LV;              // Àä·ç
 292   1      }
 293          //----------------------------------------------------------------------------//
 294          // ËµÃ÷£º¿ª¹Ø³õÊ¼»¯£¬×ªËÙµ²£¬ÎÂ¶Èµ²£¬Àä·çµ²£¬³õÊ¼Öµ¸ø¶¨
 295          //void KeysInitial(void)
 296          //{
 297          //  SpeedShiftStep = SpeedSavedStep = START_SPD_CMD_LV;   // ×ªËÙ
 298          //  HeatShiftStep = HeatSavedStep = START_HEAT_CMD_LV;    // ÎÂ¶È
 299          //  CoolShiftLv = CoolSavedLv = START_COOL_CMD_LV;        // Àä·ç
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 6   

 300          
 301          //  CalSpeedStepToCmd();
 302          //  CalHeatStepToCmd();
 303          //  CalCoolLvToCmd();
 304          //}
 305          //----------------------------------------------------------------------------//
 306          // ËµÃ÷£º´µ·ç»ú°´¼ü¿ØÖÆ
 307          void DryerPer1ms(void)
 308          {
 309   1        
 310   1        KeyPro1msTmr = Loop1msCnt;   // Óë LoopProPer1ms() ¼ÆÊýÒ»ÖÂ
 311   1        
 312   1        // ·ÖÊ±´¦Àí
 313   1        if(KeyPro1msTmr == 2)
 314   1        {
 315   2          // ¶ÁÈ¡×Ü¿ª¹Ø×´Ì¬
 316   2      
 317   2          // ¨‹--------------------------------------¨‹ //
 318   2          // 1. ÎÞ¿ª¹Ø£¬ÉÏµçÔËÐÐ
 319   2          //
 320   2          KeyOnLockLv = 1;
 321   2          
 322   2          // ¡ø--------------------------------------¡ø //
 323   2           
 324   2          // ¨‹--------------------------------------¨‹ //
 325   2          // 2. ÈýÌ¬¿ª¹Ø´¦Àí£¬¹Ø±Õ¡¢ÔËÐÐ¡¢Ëø¶¨
 326   2      
 327   2      //    KeyOnLockSmpOld = KeyOnLockSmpNew;        // ±£ÁôÉÏ´Î²ÉÑùÖµ
 328   2      //    KeyOnLockLvPre = KeyOnLockLv;             // ±£ÁôÉÏ´ÎÂË²¨½á¹û
 329   2      //    
 330   2      //    KeyOnLockSmpNew = KEY_ON;                 // Ê¹ÄÜ¶Ë¿Ú
 331   2      //    
 332   2      //    if(KEY_LOCK == 1)                         // Ëø¶¨¶Ë¿Ú
 333   2      //      KeyOnLockSmpNew += 2;
 334   2      //    
 335   2      //    if(KeyOnLockSmpOld == KeyOnLockSmpNew)    // ¶à´Î¼ÆÊý£¬ÂË²¨´¦Àí
 336   2      //    {
 337   2      //      if(++KeyOnLockKeepCnt >= 3)
 338   2      //      {
 339   2      //        KeyOnLockKeepCnt = 3;
 340   2      //        KeyOnLockLv = 3 - KeyOnLockSmpNew;
 341   2      //      }
 342   2      //    }
 343   2      //    
 344   2      //    if(KeyOnLockLv > 2)                        // »ñµÃÊ¹ÄÜËø¶¨Öµ
 345   2      //      KeyOnLockLv = 0;
 346   2      //    
 347   2      ////    // ¨Œ---------------------------------------- //
 348   2      ////    // ÊÇ·ñÓÐ³¤°´·´×ªÒªÇó
 349   2      ////    // a. ÎÞ
 350   2      //    if(KeyOnLockLv == 0)                       // ¹Ø±ÕÌ¬È·±£ÎÞÊä³ö£¬
 351   2      //    {
 352   2      //      if(ReverseCleanTrig == 1)
 353   2      //      {
 354   2      //        ReverseCleanTrig = 0;
 355   2      //        ReverseCleanCmd = 1;
 356   2      //        ReverseCleanX10ms = 500;
 357   2      //        
 358   2      //        KeyOnOffCmd = 1;
 359   2      //        KeyOnOffTrig = 1;
 360   2      //      }
 361   2      //        
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 7   

 362   2      //      if(ReverseCleanX10ms > 0)
 363   2      //        ReverseCleanX10ms--;
 364   2      //      else
 365   2      //      {
 366   2      //        ReverseCleanCmd = 0;
 367   2      //        KeyOnOffCmd = 0;
 368   2      //      }
 369   2      //    }
 370   2      //    else
 371   2      //    {
 372   2      //      if(KeyOnLockLvPre == 0)                  // µ±¿ª¹Ø×´Ì¬ÍÑÀë¹Ø±ÕÌ¬£¬Á¢¼´ÔËÐÐ
 373   2      //      {
 374   2      //        KeyOnOffCmd = 1;
 375   2      //        KeyOnOffTrig = 1;
 376   2      //      }
 377   2      //    }
 378   2      //    // b. ÓÐ
 379   2      ////    if(KeyOnLockLv == 0)                       // ¹Ø±ÕÌ¬È·±£ÎÞÊä³ö£¬
 380   2      ////    {
 381   2      ////      KeyOnOffCmd = 0;
 382   2      ////    }
 383   2      ////    else
 384   2      ////    {
 385   2      ////      if(KeyOnLockLvPre == 0)                  // µ±¿ª¹Ø×´Ì¬ÍÑÀë¹Ø±ÕÌ¬£¬Á¢¼´ÔËÐÐ
 386   2      ////      {
 387   2      ////        KeyOnOffCmd = 1;
 388   2      ////        KeyOnOffTrig = 1;
 389   2      ////      }
 390   2      ////    }
 391   2      //    // a.b. ½áÊø
 392   2          // ----------------------------------------¡÷ //
 393   2      
 394   2          // ¡ø--------------------------------------¡ø //
 395   2      
 396   2          // ¨‹--------------------------------------¨‹ //
 397   2          // 3. ÆôÍ£´¥Åö°´Å¥¿ØÖÆ
 398   2      
 399   2      //    KeyOnOff.New = KEY_ONOFF;//1;//
 400   2      //    
 401   2      //    if(KeyOnOff.New == KeyOnOff.Old)
 402   2      //      KeyOnOff.Filt = KeyOnOff.New;
 403   2      //    else
 404   2      //      KeyOnOff.Old = KeyOnOff.New;
 405   2      //    
 406   2      //    // »ñµÃµ÷ËÙ¶Ë¿Ú×´Ì¬
 407   2      //    KeyOnOff.Rise = 0;                  // Çå³ýÉÏÌø±äÑØ
 408   2      //    KeyOnOff.Fall = 0;                  // Çå³ýÏÂÌø±äÑØ
 409   2      //    KeyOnOff.PreLv = KeyOnOff.Lv;       // ±£´æÉÏ´ÎÖµ
 410   2      //    KeyOnOff.Lv = KeyOnOff.Filt;        // ¶ÁÈ¡±¾´ÎÖµ
 411   2      
 412   2      //    if(KeyOnOff.Lv != KeyOnOff.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 413   2      //    {
 414   2      //      if(KeyOnOff.Lv == 1)              // ±¾´ÎÎª¸ß
 415   2      //        KeyOnOff.Rise = 1;              // ÉÏÉýÑØÖÃÎ»
 416   2      //      else                              // ·ñÔòÎªÏÂ½µÑØ
 417   2      //        KeyOnOff.Fall = 1;
 418   2      //    }
 419   2      //    
 420   2      //    if(KeyOnOff.Fall == 1)              // KeyOnOff.Rise
 421   2      //    {
 422   2      //      KeyOnOff.Fall = 0;
 423   2      //      
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 8   

 424   2      //      if(KeyOnOffCmd == 0)
 425   2      //      {
 426   2      //        KeyOnOffCmd = 1;
 427   2      //        KeyOnLockLv = 1;
 428   2      //        KeyOnOffTrig = 1;
 429   2      //      }
 430   2      //      else
 431   2      //      {
 432   2      ////        if(KeyOnLockLv == 1)
 433   2      ////          KeyOnLockLv = 2;
 434   2      ////        else
 435   2      //        {
 436   2      //          KeyOnOffCmd = 0;
 437   2      //          KeyOnLockLv = 0;
 438   2      //        }
 439   2      //      }
 440   2      //    }
 441   2      
 442   2          // ¡ø--------------------------------------¡ø //
 443   2          
 444   2          if(RePowerRunTrig == 1)
 445   2          {
 446   3            if(KeyOnLockLv > 0)
 447   3            {
 448   4              KeyOnOffCmd = 1;
 449   4              KeyOnOffTrig = 1;
 450   4            }
 451   3            
 452   3            RePowerRunTrig = 0;
 453   3          }
 454   2          
 455   2          if(KeyOnOffCmd == 0)
 456   2            KeyGoDuty = 0;
 457   2          
 458   2        }
 459   1        else if(KeyPro1msTmr == 3)
 460   1        {
 461   2          // ×Ü¿ª¹ØÓÐÐ§Ê±£¬¼ì²â¸÷°´Å¥
 462   2          {
 463   3            KeySpeed.New = KEY_SPEED;
 464   3            // Á¬ÐøÁ½´Î¼ì²âÎªÍ¬Ò»Öµ£¬È·ÈÏµ±Ç°Öµ
 465   3            if(KeySpeed.New == KeySpeed.Old)
 466   3              KeySpeed.Filt = KeySpeed.New;
 467   3            else
 468   3              KeySpeed.Old = KeySpeed.New;
 469   3            
 470   3            KeyHeat.New = KEY_HEAT;
 471   3            if(KeyHeat.New == KeyHeat.Old)
 472   3              KeyHeat.Filt = KeyHeat.New;
 473   3            else
 474   3              KeyHeat.Old = KeyHeat.New;
 475   3            
 476   3            KeyCool.New = KEY_COOL;
 477   3            if(KeyCool.New == KeyCool.Old)
 478   3              KeyCool.Filt = KeyCool.New;
 479   3            else
 480   3              KeyCool.Old = KeyCool.New;
 481   3            
 482   3            // »ñµÃµ÷ËÙ¶Ë¿Ú×´Ì¬
 483   3            KeySpeed.Rise = 0;                  // Çå³ýÉÏÌø±äÑØ
 484   3            KeySpeed.Fall = 0;                  // Çå³ýÏÂÌø±äÑØ
 485   3            KeySpeed.PreLv = KeySpeed.Lv;       // ±£´æÉÏ´ÎÖµ
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 9   

 486   3            KeySpeed.Lv = KeySpeed.Filt;        // ¶ÁÈ¡±¾´ÎÖµ
 487   3             
 488   3            if(KeySpeed.Lv != KeySpeed.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 489   3            {
 490   4              if(KeySpeed.Lv == 1)              // ±¾´ÎÎª¸ß
 491   4                KeySpeed.Rise = 1;              // ÉÏÉýÑØÖÃÎ»
 492   4              else                              // ·ñÔòÎªÏÂ½µÑØ
 493   4              KeySpeed.Fall = 1;
 494   4            }
 495   3            
 496   3            // »ñµÃ¼ÓÈÈ¶Ë¿Ú×´Ì¬
 497   3            KeyHeat.Rise = 0;                 // Çå³ýÉÏÌø±äÑØ
 498   3            KeyHeat.Fall = 0;                 // Çå³ýÏÂÌø±äÑØ
 499   3            KeyHeat.PreLv = KeyHeat.Lv;       // ±£´æÉÏ´ÎÖµ
 500   3            KeyHeat.Lv = KeyHeat.Filt;
 501   3          
 502   3            if(KeyHeat.Lv != KeyHeat.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 503   3            {
 504   4              if(KeyHeat.Lv == 1)             // ±¾´ÎÎª¸ß
 505   4                KeyHeat.Rise = 1;             // ÉÏÉýÑØÖÃÎ»
 506   4              else                            // ·ñÔòÎªÏÂ½µÑØ
 507   4              KeyHeat.Fall = 1;
 508   4            }
 509   3            
 510   3            // »ñµÃÀä·ç¶Ë¿Ú×´Ì¬
 511   3            KeyCool.Rise = 0;                 // Çå³ýÉÏÌø±äÑØ
 512   3            KeyCool.Fall = 0;                 // Çå³ýÏÂÌø±äÑØ
 513   3            KeyCool.PreLv = KeyCool.Lv;       // ±£´æÉÏ´ÎÖµ
 514   3          
 515   3            KeyCool.Lv = KeyCool.Filt;
 516   3      
 517   3            if(KeyCool.Lv != KeyCool.PreLv)   // Èç±¾´Î²»Í¬ÓÚÉÏ´Î£¬ÅÐ¶ÏÊÇºÎÖÖÌø±ä
 518   3            {
 519   4              if(KeyCool.Lv == 1)             // ±¾´ÎÎª¸ß
 520   4                KeyCool.Rise = 1;             // ÉÏÉýÑØÖÃÎ»
 521   4              else                            // ·ñÔòÎªÏÂ½µÑØ
 522   4              KeyCool.Fall = 1;
 523   4            }
 524   3      
 525   3            // ÓÐÐ§×´Ì¬¼ÆÊ±
 526   3            if(KeySpeed.Lv == 0)
 527   3            {
 528   4              if(++KeySpeedActX10ms == 100)
 529   4                ReverseCleanTrig = 1;
 530   4              else if(KeySpeedActX10ms >= 101)
 531   4                KeySpeedActX10ms = 101;
 532   4            }
 533   3            else
 534   3              KeySpeedActX10ms = 0;
 535   3      
 536   3          }
 537   2        }
 538   1        else if(KeyPro1msTmr == 4)
 539   1        {
 540   2          if(KeyOnOffCmd == 1)       // ¿ªÆôÊ±¸÷°´¼üÓÐÐ§
 541   2          {
 542   3      
 543   3            // 
 544   3            if(KeyOnLockLv != 0)     // Ò»¼üÀä·ç²»¿¼ÂÇËø¶¨Ì¬
 545   3            {
 546   4              // ¨‹--------------------------------------¨‹ //
 547   4              // 1. Àä·ç°´¼ü´¦Àí,°´ÏÂÇÐ»»ÊÇ·ñÀä·ç
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 10  

 548   4      //        if(KeyCool.Fall == 1)
 549   4      //        {
 550   4      //          KeyCool.Fall = 0;
 551   4      //          
 552   4      //          if(CoolShiftLv == 0)
 553   4      //            CoolShiftLv = 1;
 554   4      //          else
 555   4      //            CoolShiftLv = 0;
 556   4      //          
 557   4      //          CoolCmdLv = CoolShiftLv;
 558   4      //        }
 559   4              // ¡ø--------------------------------------¡ø //
 560   4              
 561   4              // ¨‹--------------------------------------¨‹ //
 562   4              // 2. Àä·ç°´¼ü´¦Àí,Ö»ÔÚ°´ÏÂÊ±Àä·ç
 563   4              if(KeyCool.Lv == 0)
 564   4                CoolCmdLv = CoolShiftLv = 1;
 565   4              else
 566   4                CoolCmdLv = CoolShiftLv = 0;
 567   4              // ¡ø--------------------------------------¡ø //
 568   4            }
 569   3            
 570   3            if(KeyOnLockLv == 1)    // Ëø¶¨Ê±µ÷ËÙµ÷ÎÂÎÞÐ§
 571   3            {
 572   4              // µ÷ËÙ°´¼ü´¦Àí
 573   4              if(KeySpeed.Fall == 1)
 574   4              {
 575   5                KeySpeed.Fall = 0;
 576   5                
 577   5                SpeedShiftStep++;
 578   5                CalSpeedStepToCmd();
 579   5              }
 580   4              
 581   4              // 2µ²´¦Àí
 582   4      //        if(KeySpeed.Fall == 1)
 583   4      //        {
 584   4      //          KeySpeed.Fall = 0;
 585   4      //          
 586   4      //          SpeedShiftStep++;
 587   4      //          
 588   4      //          if(SpeedShiftStep >= 3)
 589   4      //            SpeedShiftStep = 1;
 590   4      
 591   4      //            SpeedCmdLv = SpeedShiftStep;
 592   4      //        }
 593   4              
 594   4              // ¼ÓÈÈ°´¼ü´¦Àí
 595   4              if(KeyHeat.Fall == 1)
 596   4              {
 597   5                KeyHeat.Fall = 0;
 598   5      
 599   5                // ¼ÓÈÈ°´¼üÈ¡ÏûÀä·ç×´Ì¬
 600   5                //if(CoolCmdLv == 1)
 601   5                //  CoolCmdLv = 0;
 602   5      
 603   5                if(CoolCmdLv == 0)          // µ±Ç°·ÇÀä·ç×´Ì¬£¬°´Å¥ÓÐÐ§
 604   5                {
 605   6                  HeatShiftStep++;
 606   6                  CalHeatStepToCmd();
 607   6                }
 608   5              }
 609   4            }
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 11  

 610   3          }
 611   2        }
 612   1        else if(KeyPro1msTmr == 5)
 613   1        {
 614   2          
 615   2          //xjc  1µµ·çËÙ34000 Ò»´Î¼Óµµ·çËÙ¼Ó1000
 616   2      
 617   2            VspSpdCmd =   (SPEED_LV1 + (SpeedCmdLv - 1)*(SPEED_LV_ADD)) >> 1;
 618   2            KeyGoDuty =   POWER_UXI_SMP_LV3;
 619   2      //    // ¸ù¾Ýµ²Î»¸ø¶¨ËÙ¶È
 620   2      //    if(SpeedCmdLv == 3)
 621   2      //    {
 622   2      //      VspSpdCmd = SPEED_LV3;
 623   2      //      KeyGoDuty = POWER_DUTY_LV3;
 624   2      //      //VspPwrCmd = POWER_UXI_SMP_LV3;
 625   2      //    }
 626   2      //    else if(SpeedCmdLv == 2)
 627   2      //    {
 628   2      //      VspSpdCmd = SPEED_LV2;
 629   2      //      KeyGoDuty = POWER_DUTY_LV2;
 630   2      //      //VspPwrCmd = POWER_UXI_SMP_LV2;
 631   2      //    }
 632   2      //    else // if(SpeedCmdLv == 1)
 633   2      //    {
 634   2      //      VspSpdCmd = SPEED_LV1;
 635   2      //      KeyGoDuty = POWER_DUTY_LV1;
 636   2      //      //VspPwrCmd = POWER_UXI_SMP_LV1;
 637   2      //    }
 638   2          
 639   2          if(ReverseCleanCmd == 1)
 640   2            VspSpdCmd = _Q15(60000 / MOTOR_SPEED_BASE);
 641   2          
 642   2          // ÏÞ×ªËÙ»òÏÞ¹¦ÂÊ
 643   2          #if (CONTROL_TARGET==CONTROL_TARGET_POWER)
                  {
                    // ÏÞ×ªËÙ
                     if(mcFocCtrl.SpeedFlt > _Q15((GIVEN_MAX_RPM) / MOTOR_SPEED_BASE))
                       KeyGoDutyMax -= 10;
                     else if(mcFocCtrl.SpeedFlt < _Q15((GIVEN_MAX_RPM-1000) / MOTOR_SPEED_BASE))
                       KeyGoDutyMax += 10;
                    
                     if(KeyGoDutyMax > _Q12(1.0))
                       KeyGoDutyMax = _Q12(1.0);
                     else if(KeyGoDutyMax < _Q12(0.15))
                       KeyGoDutyMax = _Q12(0.15);
                     
                     if(KeyGoDuty > KeyGoDutyMax)
                      KeyGoDuty = KeyGoDutyMax;
                  }
                  #elif (CONTROL_TARGET==CONTROL_TARGET_SPEED)
 660   2          {
 661   3            // ÏÞ¹¦ÂÊ£¬ÏÞµçÁ÷
 662   3            // ¸ø¶¨ÖÍ»ØÇø£¬ÔÚ¿É¿Ø×ªËÙ·¶Î§ÄÚ×öÏÞÖÆ
 663   3            if(IBusFilt_mA > (u16)(I_BUS_MAX*1000))               //365)//810)//       
 664   3              VspSpdCmdMax-=10;
 665   3            else if(IBusFilt_mA < (u16)((I_BUS_MAX-0.010)*1000))  //355)//800)//  
 666   3              VspSpdCmdMax+=10;
 667   3            
 668   3            if(VspSpdCmdMax > GIVEN_MAX_SPD)
 669   3              VspSpdCmdMax = GIVEN_MAX_SPD;
 670   3            else if(VspSpdCmdMax < GIVEN_MIN_SPD)
 671   3              VspSpdCmdMax = GIVEN_MIN_SPD;
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 12  

 672   3      
 673   3            if(VspSpdCmd > VspSpdCmdMax)
 674   3              VspSpdCmd = VspSpdCmdMax;
 675   3              
 676   3          }
 677   2          #endif
 678   2          
 679   2          if(KeyOnOffCmd == 0)
 680   2            KeyGoDuty = 0;
 681   2          
 682   2        }
 683   1        else if(KeyPro1msTmr == 6)
 684   1        {
 685   2          // ÊÇ·ñ¼ì²âµçÈÈË¿ÎÂ¶È¡£
 686   2      //    #if (CHECK_HEATER_TEMPER == 1)
 687   2      //    WindTemperNow = HeatTemperCelsius;    // ÈçÊÇ£¬¼ì²â¡£
 688   2      //    HeatAdcValNow = HeatTemperADCVal;
 689   2      //    #else
 690   2      //    WindTemperNow = 25;                   // Èç·ñ£¬¸ø¶¨µ±Ç°ÎÂ¶ÈÎª³£ÎÂÖµ¡£
 691   2      //    HeatAdcValNow = HEAT_CELSIUS_ADC(100.0);
 692   2      //    #endif
 693   2              
 694   2      
 695   2      //    if(mcState == mcRun)                // ½öÔÚµç»úÔËÐÐÊ±¿ªµçÈÈË¿
 696   2      //      HeatDisableFlag = 0;
 697   2      //    else
 698   2      //    
 699   2          
 700   2        
 701   2          // È·¶¨¸÷µ²Î»ÈÈ¶È×î¸ßµ÷½ÚÁ¿
 702   2      
 703   2          if((CoolCmdLv == 1)||(KeyOnOffCmd == 0)||(mcState != mcRun))
 704   2          {
 705   3            HeatDisableFlag = 1;
 706   3            HeatDutyMax = 0;
 707   3          }
 708   2          else
 709   2          {
 710   3            HeatDisableFlag = 0;
 711   3            // ²»Í¬µ²Î»¶ÔÓ¦µÄµçÈÈÕ¼¿Õ±ÈºÍÎÂ¶ÈÖµ
 712   3            if(HeatCmdLv == 4)
 713   3            {
 714   4              if(SpeedCmdLv == 1)
 715   4              {
 716   5                PowerVoltRiseBase = 25;
 717   5                PowerVoltDownBase = 120;
 718   5                HeatDutyMax = HEAT_DUTY_LV1 + 1; 
 719   5              }
 720   4              else if(SpeedCmdLv == 2)
 721   4              {
 722   5                PowerVoltRiseBase = 22;
 723   5                PowerVoltDownBase = 70;
 724   5                HeatDutyMax = HEAT_DUTY_LV2;
 725   5              }
 726   4              else
 727   4              {
 728   5                PowerVoltRiseBase = 25;
 729   5                PowerVoltDownBase = 55;
 730   5                HeatDutyMax = HEAT_DUTY_LV3;
 731   5              }
 732   4              WindTemperRef = HEAT_TEMPER_LV4;
 733   4              HeatAdcValRef = HEAT_ADC_VAL_LV4;
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 13  

 734   4              
 735   4            }
 736   3            else if(HeatCmdLv == 3)
 737   3            {
 738   4                WindTemperRef = HEAT_TEMPER_LV3;
 739   4                HeatAdcValRef = HEAT_ADC_VAL_LV3;
 740   4              if(SpeedCmdLv == 1)
 741   4              {
 742   5                PowerVoltRiseBase = 22;
 743   5                PowerVoltDownBase = 60;
 744   5                WindTemperRef = HEAT_TEMPER_LV3 - 2; 
 745   5                HeatDutyMax = HEAT_DUTY_LV3 - 2;
 746   5              }
 747   4              else if(SpeedCmdLv == 2)
 748   4              {
 749   5                HeatDutyMax = HEAT_DUTY_LV3 - 1;
 750   5                PowerVoltRiseBase = 25;
 751   5                PowerVoltDownBase = 55;
 752   5              }
 753   4              else
 754   4              {
 755   5                HeatDutyMax = HEAT_DUTY_LV3;
 756   5                PowerVoltRiseBase = 25;
 757   5                PowerVoltDownBase = 55;
 758   5              }   
 759   4            }
 760   3            else if(HeatCmdLv == 2)
 761   3            {
 762   4             if(SpeedCmdLv == 1)
 763   4             {
 764   5               PowerVoltRiseBase = 35;
 765   5               PowerVoltDownBase = 100;
 766   5               WindTemperRef = HEAT_TEMPER_LV2 - 2; 
 767   5               HeatDutyMax = HEAT_DUTY_LV2 - 3;
 768   5             }
 769   4             else if(SpeedCmdLv == 2)
 770   4             {
 771   5              PowerVoltRiseBase = 25;
 772   5              PowerVoltDownBase = 80;
 773   5              HeatDutyMax = HEAT_DUTY_LV2 - 1;
 774   5              WindTemperRef = HEAT_TEMPER_LV2;
 775   5              HeatAdcValRef = HEAT_ADC_VAL_LV2;
 776   5             }
 777   4             else
 778   4             {
 779   5              PowerVoltRiseBase = 22;
 780   5              PowerVoltDownBase = 70;
 781   5              HeatDutyMax = HEAT_DUTY_LV2;
 782   5              WindTemperRef = HEAT_TEMPER_LV2;
 783   5              HeatAdcValRef = HEAT_ADC_VAL_LV2;
 784   5             }
 785   4            }
 786   3            else if(HeatCmdLv == 1)
 787   3            {
 788   4              if(SpeedCmdLv == 1)
 789   4             {
 790   5              PowerVoltRiseBase = 45;
 791   5              PowerVoltDownBase = 120;
 792   5              HeatDutyMax = HEAT_DUTY_LV1 - 2;
 793   5              WindTemperRef = HEAT_TEMPER_LV1;
 794   5              HeatAdcValRef = HEAT_ADC_VAL_LV1;
 795   5             }
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 14  

 796   4              else if(SpeedCmdLv == 2)
 797   4             {
 798   5               PowerVoltRiseBase = 45;
 799   5               PowerVoltDownBase = 120;
 800   5               HeatDutyMax = HEAT_DUTY_LV1 - 1;
 801   5             }
 802   4             else
 803   4             {
 804   5              PowerVoltRiseBase = 40;
 805   5              PowerVoltDownBase = 120;
 806   5              HeatDutyMax = HEAT_DUTY_LV1;
 807   5             }
 808   4            }
 809   3            else
 810   3            {
 811   4              HeatDutyMax = 0;
 812   4              WindTemperRef = 10;
 813   4              HeatAdcValRef = 4096;
 814   4            }
 815   3          }
 816   2          
 817   2          // Á½ÖÖµçÈÈË¿¿ØÖÆ·½Ê½£¬Ò»²»¿ØÎÂ£¬¶þ¿ØÎÂ
 818   2          // ¨‹--------------------------------------¨‹ //
 819   2          // 1.¸ù¾Ýµ²Î»È·¶¨Êä³öÁ¿-Õ¼¿Õ±È£¬²»µ÷ÎÂ
 820   2      //    HeatDuty = HeatDutyMax;
 821   2          // ¡ø--------------------------------------¡ø //
 822   2          
 823   2          // ¨‹--------------------------------------¨‹ //
 824   2          // 2.¸ù¾Ýµ²Î»¸ø¶¨µÄÎÂ¶È£¬µ÷½ÚÊä³öÁ¿-Õ¼¿Õ±È£¬µ÷ÎÂ
 825   2          #if (CHECK_HEATER_TEMPER == 1)    // ÈçÐè¼ì²âµçÈÈË¿ÎÂ¶È
 826   2          // a.b. ¶þÑ¡Ò»
 827   2          // a.¸ù¾Ý²âµÃÉãÊÏ¶È
 828   2          if(mcState == mcRun)
 829   2          {
 830   3          if(HeatTemperCelsius > HEAT_TEMPER_LV1)             //µ±Ç°ÎÂ¶È¸ßÓÚ¸ø¶¨Öµ£¬ÉèÖÃ¹ýÎÂ±êÖ¾
 831   3          {
 832   4            WindTemperHigh = 1;
 833   4            WindTemperDelta = 0;
 834   4      //      SaveCnt = 0;
 835   4          }
 836   3          }
 837   2      //    else if(HeatTemperCelsius <= (WindTemperRef-0))    //Îª·ÀÖ¹ÁÙ½çµãÊ¶±ð¶¶¶¯£¬µ±Ç°ÎÂ¶ÈµÍÓÚ¸ø¶¨Öµ¼õÈ¥ÖÍ»
             -ØÇø¼ä£¬
 838   2      //    {
 839   2      //      WindTemperHigh = 0;
 840   2      //      WindTemperDelta = WindTemperRef - HeatTemperCelsius;
 841   2      //    }
 842   2          
 843   2          // b.¸ù¾ÝADC²ÉÑùÖµ
 844   2      //    if(HeatTemperADCVal < HeatAdcValRef)             //µ±Ç°ÎÂ¶È¸ßÓÚ¸ø¶¨Öµ£¬ÉèÖÃ¹ýÎÂ±êÖ¾
 845   2      //      WindTemperHigh = 1;
 846   2      //    else if(HeatTemperADCVal > (HeatAdcValRef+10))  //Îª·ÀÖ¹ÁÙ½çµãÊ¶±ð¶¶¶¯£¬µ±Ç°ÎÂ¶ÈµÍÓÚ¸ø¶¨Öµ¼õÈ¥ÖÍ»ØÇø
             -¼ä£¬
 847   2      //      WindTemperHigh = 0;
 848   2          
 849   2          // a.b.½áÊø
 850   2          if(HeatTemperADCVal > 4050)                       // ÏßÂ·¹ÊÕÏÊ±£¬²ÉÑùÖµ½«½Ó½üQ12(1),°²È«ÖµÒÔÏÂ¿ªÆôµçÈÈ
             -Ë¿
 851   2            HeatDutyMax = 0;
 852   2          
 853   2          #else                                             // Èç·ñ£¬²»²âÎÂ¶È£¬±£³Ö¼ÓÈÈ×´Ì¬
                  WindTemperHigh = 0;
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 15  

                  
                  #endif
 857   2          
 858   2          if(CoolCmdLv != 1)
 859   2          {
 860   3      //      if(++HeatRegulTmr >= 6)
 861   3      //      {
 862   3      //        HeatRegulTmr = 0;
 863   3      //        
 864   3      //        if(WindTemperHigh == 1)
 865   3      //        {
 866   3      //          if(HeatDutyAlt > 0)
 867   3      //            HeatDutyAlt--;
 868   3      //          
 869   3      //          HeatDutyAltTop = 0;
 870   3      //        }
 871   3      //        else
 872   3      //        {
 873   3      //          HeatDutyAlt++;
 874   3      //          if(WindTemperDelta < 20)
 875   3      //            HeatDutyAltTop = WindTemperDelta;
 876   3      //          else
 877   3      //            HeatDutyAltTop = 19;
 878   3      //        }
 879   3      //      }
 880   3            HeatDutyAlt = HeatDutyMax;
 881   3          }
 882   2          else
 883   2          {
 884   3            HeatRegulTmr = 0;
 885   3          }
 886   2          // ¨Œ---------------------------------------- //
 887   2          // 4µ²ÈÈÎªÀäÈÈÑ­»··ç
 888   2          #if (HEAT_CMD_LV_MAX == 4)
 889   2          if(HeatCmdLv == 4 && CoolCmdLv == 0)
 890   2          {
 891   3            if(++HeatLv4X10ms > 1142)
 892   3              HeatLv4X10ms = 0;
 893   3            else if(HeatLv4X10ms > 428)
 894   3              HeatDutyMax = 0;
 895   3          }
 896   2          else
 897   2            HeatLv4X10ms = 0;
 898   2          #endif
 899   2          // ----------------------------------------¡÷ //
 900   2              
 901   2      //    if(HeatDutyAlt > HeatDutyAltTop)
 902   2      //      HeatDutyAlt = HeatDutyAltTop;
 903   2          
 904   2          if(HeatDutyAlt > HeatDutyMax)
 905   2            HeatDutyAlt = HeatDutyMax;
 906   2          
 907   2          if(HeatDutyMax != 0)
 908   2          {
 909   3            if(HeatDutyAlt > HearterPMWDutyDowm)
 910   3            {
 911   4              HeatDutyAlt = HeatDutyAlt + HearterPMWDutyRise - HearterPMWDutyDowm;
 912   4            }
 913   3            else
 914   3            {
 915   4              HeatDutyAlt = 1;
 916   4            }
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 16  

 917   3          }
 918   2      
 919   2          if(HeatDutyAlt > 20)
 920   2            HeatDutyAlt = 20;
 921   2          
 922   2          HeatDutyH = HeatDutyAlt/2;
 923   2          HeatDutyL = HeatDutyH + HeatDutyAlt%2;
 924   2      
 925   2          // ¡ø--------------------------------------¡ø //
 926   2          
 927   2        }
 928   1        else if(KeyPro1msTmr == 7)
 929   1        {
 930   2          
 931   2          // xjc ·çËÙµµ°´ÕÕ¶þ½øÖÆÁÁµÆ
 932   2          if(mcState == mcRun && KeyOnOffCmd == 1){
 933   3              
 934   3            LED_SPEED_bit_1 = !(bit)((SpeedCmdLv & 0x01)>>0);
 935   3            LED_SPEED_bit_2 = !(bit)((SpeedCmdLv & 0x02)>>1);
 936   3            LED_SPEED_bit_3 = !(bit)((SpeedCmdLv & 0x04)>>2);
 937   3            LED_SPEED_bit_4 = !(bit)((SpeedCmdLv & 0x08)>>3);
 938   3            LED_SPEED_bit_5 = !(bit)((SpeedCmdLv & 0x10)>>4);
 939   3            LED_SPEED_bit_6 = !(bit)((SpeedCmdLv & 0x20)>>5);       
 940   3            
 941   3            }
 942   2          
 943   2      //    
 944   2      //    // ¨Œ---------------------------------------- //
 945   2      //    // ËÙ¶ÈÖ¸Ê¾µÆ±äÁ¿È«²¿Çå³ý
 946   2      //    LedSpd1 = LED_SET_OFF;
 947   2      //    LedSpd2 = LED_SET_OFF;
 948   2      //    LedSpd3 = LED_SET_OFF;
 949   2      //    
 950   2      //    // ÈÈ¶ÈÖ¸Ê¾µÆ±äÁ¿È«²¿Çå³ý
 951   2      //    LedHeat1 = LED_SET_OFF;
 952   2      //    LedHeat2 = LED_SET_OFF;
 953   2      //    LedHeat3 = LED_SET_OFF;
 954   2      //    
 955   2      //    // ¸ù¾ÝËÙ¶ÈÖ¸ÁîÁÁµÆ
 956   2      //    if(mcState == mcRun)
 957   2      //    {
 958   2      //      if(KeyOnOffCmd == 1)
 959   2      //      {
 960   2      //        if(SpeedCmdLv == 1)
 961   2      //        {
 962   2      //          LedSpd1 = LED_SET_ON;
 963   2      //        }
 964   2      //        else if(SpeedCmdLv == 2)
 965   2      //        {
 966   2      //          LedSpd1 = LED_SET_ON;
 967   2      //          LedSpd2 = LED_SET_ON;
 968   2      //        }
 969   2      //        else if(SpeedCmdLv == 3)
 970   2      //        {
 971   2      //          LedSpd1 = LED_SET_ON;
 972   2      //          LedSpd2 = LED_SET_ON;
 973   2      //          LedSpd3 = LED_SET_ON;
 974   2      //        }
 975   2      //      }
 976   2      //    }
 977   2      //    else
 978   2      //    {
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 17  

 979   2      //      if(++LedAlarmFlashCnt < 50)
 980   2      //      {
 981   2      //        if(AlarmFlag2 & 0x01)
 982   2      //        {
 983   2      //          LedSpd1 = LED_SET_ON;
 984   2      //          LedSpd2 = LED_SET_ON;
 985   2      //          LedSpd3 = LED_SET_ON;
 986   2      //          LedHeat1 = LED_SET_ON;
 987   2      //          LedHeat2 = LED_SET_ON;
 988   2      //          LedHeat3 = LED_SET_ON;
 989   2      //        }
 990   2      //        else if(AlarmFlag & 0x01)
 991   2      //        {
 992   2      //          LedSpd1 = LED_SET_ON;
 993   2      //          LedSpd2 = LED_SET_ON;
 994   2      //        }
 995   2      //        else if(AlarmFlag & 0x02)
 996   2      //        {
 997   2      //          LedSpd1 = LED_SET_ON;
 998   2      //          LedHeat1 = LED_SET_ON;
 999   2      //          LedHeat2 = LED_SET_ON;
1000   2      //        }
1001   2      //        else if(AlarmFlag & 0x04)
1002   2      //        {
1003   2      //          LedHeat1 = LED_SET_ON;
1004   2      //          LedHeat2 = LED_SET_ON;
1005   2      //          LedHeat3 = LED_SET_ON;
1006   2      //        }
1007   2      //        else if(AlarmFlag & 0x08)
1008   2      //        {
1009   2      //          LedSpd3 = LED_SET_ON;
1010   2      //          LedHeat1 = LED_SET_ON;
1011   2      //          LedHeat2 = LED_SET_ON;
1012   2      //          LedHeat3 = LED_SET_ON;
1013   2      //        }
1014   2      //        else if(AlarmFlag & 0x10)
1015   2      //        {
1016   2      //          LedSpd1 = LED_SET_ON;
1017   2      //        }
1018   2      //        else if(AlarmFlag & 0x40)
1019   2      //        {
1020   2      //          LedSpd2 = LED_SET_ON;
1021   2      //          LedSpd3 = LED_SET_ON;
1022   2      //          LedHeat1 = LED_SET_ON;
1023   2      //          LedHeat2 = LED_SET_ON;
1024   2      //          LedHeat3 = LED_SET_ON;
1025   2      //        }
1026   2      //      }
1027   2      //      else if(LedAlarmFlashCnt > 100)
1028   2      //      {   
1029   2      //        LedAlarmFlashCnt = 0;
1030   2      //      }
1031   2      //    }
1032   2      //    
1033   2      ////    if(mcState != mcRun)
1034   2      ////    {
1035   2      ////      if(SpeedCmdLv == 1)
1036   2      ////        LedSpd1 = LED_SET_ON;
1037   2      ////      else if(SpeedCmdLv == 2)
1038   2      ////        LedSpd2 = LED_SET_ON;
1039   2      ////      else
1040   2      ////        LedSpd3 = LED_SET_ON;
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 18  

1041   2      ////    }
1042   2      //    
1043   2      //    LED_SPEED_1 = LedSpd1;
1044   2      //    LED_SPEED_2 = LedSpd2;
1045   2      //    LED_SPEED_3 = LedSpd3;
1046   2      //    // ----------------------------------------¡÷ //
1047   2      //    
1048   2      //    // ¨Œ---------------------------------------- //
1049   2      //    // ÈÈ¶ÈÖ¸Ê¾µÆ±äÁ¿È«²¿Çå³ý
1050   2      ////    LedHeat1 = LED_SET_OFF;
1051   2      ////    LedHeat2 = LED_SET_OFF;
1052   2      ////    LedHeat3 = LED_SET_OFF;
1053   2      //    
1054   2      //    // ¸ù¾ÝÈÈ¶ÈÖ¸ÁîÁÁµÆ
1055   2      //    if(HeatDisableFlag == 0)
1056   2      //    {
1057   2      //      if(HeatCmdLv == 1)
1058   2      //      {
1059   2      //        LedHeat1 = LED_SET_ON;
1060   2      //      }
1061   2      //      else if(HeatCmdLv == 2)
1062   2      //      {
1063   2      //        LedHeat1 = LED_SET_ON;
1064   2      //        LedHeat2 = LED_SET_ON;
1065   2      //      }
1066   2      //      else if(HeatCmdLv == 3)
1067   2      //      {
1068   2      //        LedHeat1 = LED_SET_ON;
1069   2      //        LedHeat2 = LED_SET_ON;
1070   2      //        LedHeat3 = LED_SET_ON;
1071   2      //      }
1072   2      //      else if(HeatCmdLv == 4)
1073   2      //      {
1074   2      //          
1075   2      //        if(++LedAltX10ms < 70)
1076   2      //        {LedHeat1 = LED_SET_ON;}
1077   2      //        else if(LedAltX10ms < 140)
1078   2      //        {
1079   2      //          LedHeat1 = LED_SET_ON;
1080   2      //          LedHeat2 = LED_SET_ON;
1081   2      //        }
1082   2      //        else if(LedAltX10ms < 210)
1083   2      //        {
1084   2      //          LedHeat1 = LED_SET_ON;
1085   2      //          LedHeat2 = LED_SET_ON;
1086   2      //          LedHeat3 = LED_SET_ON;
1087   2      //        }
1088   2      //        else if(LedAltX10ms < 280)
1089   2      //        {
1090   2      //          ;
1091   2      //        }
1092   2      //        else
1093   2      //          LedAltX10ms = 0;
1094   2      //      }
1095   2      //    }
1096   2      //    else
1097   2      //    {
1098   2      //      LedAltX10ms = 0;
1099   2      //    }
1100   2      ////    if(mcState != mcRun)
1101   2      ////    {
1102   2      ////    
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 19  

1103   2      ////      if(mcState != mcReady)
1104   2      ////      {
1105   2      ////        if(HeatCmdLv == 1)
1106   2      ////          LedHeat1 = LED_SET_ON;
1107   2      ////        else if(HeatCmdLv == 2)
1108   2      ////          LedHeat2 = LED_SET_ON;
1109   2      ////        else
1110   2      ////          LedHeat3 = LED_SET_ON;
1111   2      ////      }
1112   2      ////    }
1113   2      
1114   2      //    LED_HEAT_1 = LedHeat1;
1115   2      //    LED_HEAT_2 = LedHeat2;
1116   2      //    LED_HEAT_3 = LedHeat3;
1117   2          // ----------------------------------------¡÷ //
1118   2        }
1119   1      //  else if(KeyPro1msTmr == 8)
1120   1      //  {
1121   1      
1122   1      //   
1123   1      //  }
1124   1      //  else if(KeyPro1msTmr == 9)
1125   1      //  {
1126   1          // ÔËÐÐ²ÊµÆ£¬Í£Ö¹×Ï£¬ÔËÐÐÂÌ
1127   1      //    if(KeyOnOffCmd == 0)
1128   1      //    {
1129   1      //      LED_RED = LED_SET_ON;
1130   1      //      LED_GREEN = LED_SET_OFF;
1131   1      //      LED_BLUE = LED_SET_ON;
1132   1      //    }
1133   1      //    else
1134   1      //    {
1135   1      //      LED_RED = LED_SET_OFF;
1136   1      //      LED_GREEN = LED_SET_ON;
1137   1      //      LED_BLUE = LED_SET_OFF;
1138   1      //    }
1139   1      //  }
1140   1      
1141   1        #if (THRYRST_ENABLE == 1)
1142   1        // Thryster ¿ØÖÆ--------------------------------//
1143   1        // ÔÚÕý³£½»Á÷ÓÃµçÇé¿öÏÂÃ¿10ms¿É²âµÃÒ»´Î¹ýÁã
1144   1        // ½»Á÷µçÔ´¹ýÁã±êÖ¾ÔÚÖÐ¶Ï´¦ÀíÖÐÉèÖÃ£¬´Ë´¦Ã¿ºÁÃë¼ì²â±êÖ¾Î»
1145   1        if(ACCrossForThryrist == 1)
1146   1        {
1147   2          ACCrossForThryrist = 0;
1148   2          
1149   2          // Êä³öÁ¿Õ¼¿Õ±È´¦Àí£¬10´Î¹ýÁãÎªÒ»¸öÖÜÆÚ
1150   2          if(HeatDutyOnCnt < HeatDutyH)
1151   2            ThryristTrigKeepCnt = 3;      // ÉèÖÃ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
1152   2          else
1153   2            ThryristTrigKeepCnt = 0;
1154   2          
1155   2          if(++HeatDutyOnCnt >= 10)
1156   2            HeatDutyOnCnt = 0;
1157   2          
1158   2          if(HeatDutyOnCnt2 >= (10 - HeatDutyL))
1159   2            ThryristTrigKeepCnt2 = 3;      // ÉèÖÃ¾§Õ¢¹Ü´¥·¢±£³ÖÊ±³¤ -ºÁÃë
1160   2           else
1161   2            ThryristTrigKeepCnt2 = 0;
1162   2          
1163   2          if(++HeatDutyOnCnt2 >= 10)
1164   2            HeatDutyOnCnt2 = 0;   
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 20  

1165   2          
1166   2      //    if(WindTemperHigh == 0)             //µ±Ç°ÎÂ¶È¸ßÓÚ¸ø¶¨Öµ£¬ÉèÖÃ¹ýÎÂ±êÖ¾
1167   2      //    {
1168   2      //      SaveCnt = 0;
1169   2      //    }
1170   2      //    else
1171   2      //    {
1172   2      //      SaveLine[SaveCnt] = HeatTemperCelsius;
1173   2      //      if(++SaveCnt>=24)
1174   2      //        SaveCnt = 0;
1175   2      //    }
1176   2        }
1177   1          
1178   1        
1179   1        // ¾§Õ¢¹Üµ¼Í¨ÐÅºÅ±£³ÖÊ±³¤NºÁÃë ¶þÑ¡Ò»
1180   1        // ¨‹--------------------------------------¨‹ //
1181   1        // 1. Í¬Ê±¿ØÖÆÁ½¸ö¹Ü×Ó
1182   1      //  if(ThryristTrigKeepCnt > 0)
1183   1      //  {
1184   1      //    ThryristTrigKeepCnt --;
1185   1      
1186   1      //    if(RunningX1ms > 1000)
1187   1      //    {
1188   1      //      HEAT_WIRE_H_ON;
1189   1      //      HEAT_WIRE_L_ON;//HEAT_WIRE_L_OFF;//
1190   1      //    }
1191   1      //    else
1192   1      //    {
1193   1      //      HEAT_WIRE_H_OFF;
1194   1      //      HEAT_WIRE_L_OFF;
1195   1      //    }
1196   1      //  }
1197   1      //  else
1198   1      //  {
1199   1      //    HEAT_WIRE_H_OFF;
1200   1      //    HEAT_WIRE_L_OFF;
1201   1      //  }
1202   1        // ¡ô--------------------------------------¡ô //
1203   1        // 2. ·Ö±ð¿ØÖÆÁ½¸ö¹Ü×Ó
1204   1        if(ThryristTrigKeepCnt > 0)
1205   1        {
1206   2      //    ThryristTrigKeepCnt --;
1207   2            
1208   2          if(RunningX1ms > 1000)
1209   2            Heat_wire_H = HEAT_WIRE_H_ON;
1210   2          else
1211   2            Heat_wire_H = HEAT_WIRE_H_OFF;
1212   2        }
1213   1        else
1214   1          Heat_wire_H = HEAT_WIRE_H_OFF;
1215   1        
1216   1      
1217   1        if(ThryristTrigKeepCnt2 > 0)
1218   1        {
1219   2      //    ThryristTrigKeepCnt2 --;
1220   2            
1221   2          if(RunningX1ms > 1000)
1222   2            Heat_wire_L = HEAT_WIRE_L_ON;
1223   2          else
1224   2            Heat_wire_L = HEAT_WIRE_L_OFF;
1225   2        }
1226   1        else
C51 COMPILER V9.60.7.0   USERDRYER                                                         10/12/2023 10:00:17 PAGE 21  

1227   1          Heat_wire_L = HEAT_WIRE_L_OFF;
1228   1        // ¡ø--------------------------------------¡ø //
1229   1        #endif
1230   1        
1231   1      //  // µ÷ÊÔÖÐ£¬¹Ø±Õ¾§Õ¢¹Ü
1232   1      //  HEAT_WIRE_H_OFF;
1233   1      //  HEAT_WIRE_L_OFF;
1234   1      
1235   1        if(PwrOnStage == 0)
1236   1        {
1237   2          KeyGoDuty = _Q12(0);
1238   2          
1239   2          if((PwrOnX1ms > 50)||(QuickStartFlag==1))
1240   2          {
1241   3            PwrOnStage = 2;
1242   3            KeyOnOffCmd = 1;
1243   3            //KeyOnLockLv = 1;
1244   3            KeyOnOffTrig = 0;
1245   3          }
1246   2        }
1247   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1770    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     12    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     37    ----
   BIT SIZE         =     11    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
